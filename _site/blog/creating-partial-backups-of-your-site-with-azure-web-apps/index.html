<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Backup just the Important Parts of your Site with Azure Web Apps &#8211; Zain Rizvi</title>
<meta name="description" content="Introducting a way to backup just the parts of your website that matter most.

Introduction

Azure Web Apps provides powerful backup/restore functionality. (Because disasters can happen to anyone)

However, sometimes you don’t want to backup everything on your site, especially if you backup your site regularly, or if your site has over 10GB of content (that’s the max amount you can backup at a time).

For example, you probably don’t want to back up the log files. Or if you setup weekly backups you won’t want to fill up your storage account with static content that never changes like old blog posts or images.

Partial backups will let you choose exactly which files you want to back up.

Specify the files you don’t want to backup

You can create a list of files and folders to exclude from the backup.

You save the list as a text file called _backup.filter in the wwwroot folder of your site. An easy way to access this is through the Kudu Console at http://{yoursite}.scm.azurewebsites.net/DebugConsole.

The instructions below will be using the Kudu Console to create the _backup.filter file, but you can use your favorite deployment method to put the file there.

What to do

I’ve got a site that contains log files and static images from past years that are never going to change.

I already have a full backup of the site which includes the old images. Now I want to backup the site every day, but I don’t want to pay for storing log files or the static image files that never change.

 

The below steps show how I’d exclude those files from the backup.

Identify the files and folders you don’t want to backup

This is easy. I already know I don’t want to backup any log files, so I want to exclude D:\home\site\wwwroot\Logs.

There’s another log file folder that all Azure Web Apps have at D:\home\LogFiles. Let’s exclude that too.

I also don’t want to backup the images from previous years over and over again. So lets add D:\home\site\wwwroot\Images\2013 and D:\home\site\wwwroot\Images\2014 to the list as well.

Finally, let’s not backup the brand.png file in the Images folder either, just to show we can blacklist individual files as well. It’s located at D:\home\site\wwwroot\Images\brand.png

This gives us the following folders that we don’t want to backup:


  D:\home\site\wwwroot\Logs
  D:\home\LogFiles
  D:\home\site\wwwroot\Images\2013
  D:\home\site\wwwroot\Images\2014
  D:\home\site\wwwroot\Images\brand.png


Create the exclusion list

You save the blacklist of files and folders that you don’t want to backup in  a special file called _backup.filter.  Create the file and place it at D:\home\site\wwwroot\_backup.filter.

List all the files and folders you don’t want to backup in the _backup.filter file. You add the full path relative to D:\home of the folder or file that you want to exclude from the backup, one path per line.

So for my site, D:\home\site\wwwroot\Logs becomes \site\wwwroot\Logs, D:\home\LogFiles becomes \LogFiles, so on and so forth, resulting in the following contents for my _backup.filter:

\site\wwwroot\Logs
\LogFiles
\site\wwwroot\Images\2013
\site\wwwroot\Images\2014
\site\wwwroot\Images\brand.png



Note the starting \ at the beginning of each line. That’s important.

Run a backup

Now you can run backups the same way you would normally do it. Manually, automatically, either way is fine.

Any files and folders that fall under the filters listed in the _backup.filter will be excluded from the backup. This means now the log files and the 2013 and 2014 image files will no longer be backed up.

Restoring your backed up site

You restore partial backups of your site the same way you would restore a regular backup. It’ll do the right thing.

The technical details

With full (non-partial) backups normally all content on the site is replaced with whatever is in the backup.  If a file is on the site but not in the backup it gets deleted.

But when restoring partial backups though any content that is located in one of the blacklisted folders (like D:\home\site\wwwroot\images\2014 for my site) will be left as is. And if individual files were black listed then they’ll also be left alone during the restore.

Best Practices

What do you do when disaster strikes and you have to restore your site?  Make sure you’re prepared beforehand.

Yeah, you have partial backups, but take at least one full backup of the site first so that you have all your site’s contents backed up (this is worst case scenario planning).  Then when you’re restoring your backups you can first restore the full backup of the site, and then restore the latest partial backup on top of it.

Here’s why: it lets you use Deployment Slots to test your restored site. You can even test the restore process without ever touching your production site. And testing your restore process is a Very Good Thing.  You never know when you might run into some subtle gotcha like I did when I tried restoring my blog and end up losing half your content.

My horror story

My blog is powered by the Ghost blogging platform.  Like a responsible dev I created a backup of my site and everything was great. Then one day I got a message saying that there was a new version of Ghost available and I could upgrade my blog to it. Great!

I created one more backup of my site to backup the latest blog posts, and proceeded to upgrade Ghost.

On my production site.

Bad mistake.

Something went wrong with the upgrade, my home screen just showed a blank screen.  “No problem” I thought, “I’ll simply restore the backup I just took.”

I restored the upgrade, saw everything come back…except the blog posts.

WHAT???

Turns out, in the Ghost upgrade notes there’s this warning:



If you try to backup the data while Ghost is running…the data doesn’t actually get backed up.

Bummer.

If I had tried the restore on a test slot first I would have seen this issue and not lost all my posts.

Such is life. It can happen to the best of us.

">
<meta name="keywords" content="">




<!-- Twitter Cards -->
<meta name="twitter:title" content="Backup just the Important Parts of your Site with Azure Web Apps">
<meta name="twitter:description" content="Introducting a way to backup just the parts of your website that matter most.

Introduction

Azure Web Apps provides powerful backup/restore functionality. (Because disasters can happen to anyone)

However, sometimes you don’t want to backup everything on your site, especially if you backup your site regularly, or if your site has over 10GB of content (that’s the max amount you can backup at a time).

For example, you probably don’t want to back up the log files. Or if you setup weekly backups you won’t want to fill up your storage account with static content that never changes like old blog posts or images.

Partial backups will let you choose exactly which files you want to back up.

Specify the files you don’t want to backup

You can create a list of files and folders to exclude from the backup.

You save the list as a text file called _backup.filter in the wwwroot folder of your site. An easy way to access this is through the Kudu Console at http://{yoursite}.scm.azurewebsites.net/DebugConsole.

The instructions below will be using the Kudu Console to create the _backup.filter file, but you can use your favorite deployment method to put the file there.

What to do

I’ve got a site that contains log files and static images from past years that are never going to change.

I already have a full backup of the site which includes the old images. Now I want to backup the site every day, but I don’t want to pay for storing log files or the static image files that never change.

 

The below steps show how I’d exclude those files from the backup.

Identify the files and folders you don’t want to backup

This is easy. I already know I don’t want to backup any log files, so I want to exclude D:\home\site\wwwroot\Logs.

There’s another log file folder that all Azure Web Apps have at D:\home\LogFiles. Let’s exclude that too.

I also don’t want to backup the images from previous years over and over again. So lets add D:\home\site\wwwroot\Images\2013 and D:\home\site\wwwroot\Images\2014 to the list as well.

Finally, let’s not backup the brand.png file in the Images folder either, just to show we can blacklist individual files as well. It’s located at D:\home\site\wwwroot\Images\brand.png

This gives us the following folders that we don’t want to backup:


  D:\home\site\wwwroot\Logs
  D:\home\LogFiles
  D:\home\site\wwwroot\Images\2013
  D:\home\site\wwwroot\Images\2014
  D:\home\site\wwwroot\Images\brand.png


Create the exclusion list

You save the blacklist of files and folders that you don’t want to backup in  a special file called _backup.filter.  Create the file and place it at D:\home\site\wwwroot\_backup.filter.

List all the files and folders you don’t want to backup in the _backup.filter file. You add the full path relative to D:\home of the folder or file that you want to exclude from the backup, one path per line.

So for my site, D:\home\site\wwwroot\Logs becomes \site\wwwroot\Logs, D:\home\LogFiles becomes \LogFiles, so on and so forth, resulting in the following contents for my _backup.filter:

\site\wwwroot\Logs
\LogFiles
\site\wwwroot\Images\2013
\site\wwwroot\Images\2014
\site\wwwroot\Images\brand.png



Note the starting \ at the beginning of each line. That’s important.

Run a backup

Now you can run backups the same way you would normally do it. Manually, automatically, either way is fine.

Any files and folders that fall under the filters listed in the _backup.filter will be excluded from the backup. This means now the log files and the 2013 and 2014 image files will no longer be backed up.

Restoring your backed up site

You restore partial backups of your site the same way you would restore a regular backup. It’ll do the right thing.

The technical details

With full (non-partial) backups normally all content on the site is replaced with whatever is in the backup.  If a file is on the site but not in the backup it gets deleted.

But when restoring partial backups though any content that is located in one of the blacklisted folders (like D:\home\site\wwwroot\images\2014 for my site) will be left as is. And if individual files were black listed then they’ll also be left alone during the restore.

Best Practices

What do you do when disaster strikes and you have to restore your site?  Make sure you’re prepared beforehand.

Yeah, you have partial backups, but take at least one full backup of the site first so that you have all your site’s contents backed up (this is worst case scenario planning).  Then when you’re restoring your backups you can first restore the full backup of the site, and then restore the latest partial backup on top of it.

Here’s why: it lets you use Deployment Slots to test your restored site. You can even test the restore process without ever touching your production site. And testing your restore process is a Very Good Thing.  You never know when you might run into some subtle gotcha like I did when I tried restoring my blog and end up losing half your content.

My horror story

My blog is powered by the Ghost blogging platform.  Like a responsible dev I created a backup of my site and everything was great. Then one day I got a message saying that there was a new version of Ghost available and I could upgrade my blog to it. Great!

I created one more backup of my site to backup the latest blog posts, and proceeded to upgrade Ghost.

On my production site.

Bad mistake.

Something went wrong with the upgrade, my home screen just showed a blank screen.  “No problem” I thought, “I’ll simply restore the backup I just took.”

I restored the upgrade, saw everything come back…except the blog posts.

WHAT???

Turns out, in the Ghost upgrade notes there’s this warning:



If you try to backup the data while Ghost is running…the data doesn’t actually get backed up.

Bummer.

If I had tried the restore on a test slot first I would have seen this issue and not lost all my posts.

Such is life. It can happen to the best of us.

">



<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://localhost:4000/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Backup just the Important Parts of your Site with Azure Web Apps">
<meta property="og:description" content="Introducting a way to backup just the parts of your website that matter most.

Introduction

Azure Web Apps provides powerful backup/restore functionality. (Because disasters can happen to anyone)

However, sometimes you don’t want to backup everything on your site, especially if you backup your site regularly, or if your site has over 10GB of content (that’s the max amount you can backup at a time).

For example, you probably don’t want to back up the log files. Or if you setup weekly backups you won’t want to fill up your storage account with static content that never changes like old blog posts or images.

Partial backups will let you choose exactly which files you want to back up.

Specify the files you don’t want to backup

You can create a list of files and folders to exclude from the backup.

You save the list as a text file called _backup.filter in the wwwroot folder of your site. An easy way to access this is through the Kudu Console at http://{yoursite}.scm.azurewebsites.net/DebugConsole.

The instructions below will be using the Kudu Console to create the _backup.filter file, but you can use your favorite deployment method to put the file there.

What to do

I’ve got a site that contains log files and static images from past years that are never going to change.

I already have a full backup of the site which includes the old images. Now I want to backup the site every day, but I don’t want to pay for storing log files or the static image files that never change.

 

The below steps show how I’d exclude those files from the backup.

Identify the files and folders you don’t want to backup

This is easy. I already know I don’t want to backup any log files, so I want to exclude D:\home\site\wwwroot\Logs.

There’s another log file folder that all Azure Web Apps have at D:\home\LogFiles. Let’s exclude that too.

I also don’t want to backup the images from previous years over and over again. So lets add D:\home\site\wwwroot\Images\2013 and D:\home\site\wwwroot\Images\2014 to the list as well.

Finally, let’s not backup the brand.png file in the Images folder either, just to show we can blacklist individual files as well. It’s located at D:\home\site\wwwroot\Images\brand.png

This gives us the following folders that we don’t want to backup:


  D:\home\site\wwwroot\Logs
  D:\home\LogFiles
  D:\home\site\wwwroot\Images\2013
  D:\home\site\wwwroot\Images\2014
  D:\home\site\wwwroot\Images\brand.png


Create the exclusion list

You save the blacklist of files and folders that you don’t want to backup in  a special file called _backup.filter.  Create the file and place it at D:\home\site\wwwroot\_backup.filter.

List all the files and folders you don’t want to backup in the _backup.filter file. You add the full path relative to D:\home of the folder or file that you want to exclude from the backup, one path per line.

So for my site, D:\home\site\wwwroot\Logs becomes \site\wwwroot\Logs, D:\home\LogFiles becomes \LogFiles, so on and so forth, resulting in the following contents for my _backup.filter:

\site\wwwroot\Logs
\LogFiles
\site\wwwroot\Images\2013
\site\wwwroot\Images\2014
\site\wwwroot\Images\brand.png



Note the starting \ at the beginning of each line. That’s important.

Run a backup

Now you can run backups the same way you would normally do it. Manually, automatically, either way is fine.

Any files and folders that fall under the filters listed in the _backup.filter will be excluded from the backup. This means now the log files and the 2013 and 2014 image files will no longer be backed up.

Restoring your backed up site

You restore partial backups of your site the same way you would restore a regular backup. It’ll do the right thing.

The technical details

With full (non-partial) backups normally all content on the site is replaced with whatever is in the backup.  If a file is on the site but not in the backup it gets deleted.

But when restoring partial backups though any content that is located in one of the blacklisted folders (like D:\home\site\wwwroot\images\2014 for my site) will be left as is. And if individual files were black listed then they’ll also be left alone during the restore.

Best Practices

What do you do when disaster strikes and you have to restore your site?  Make sure you’re prepared beforehand.

Yeah, you have partial backups, but take at least one full backup of the site first so that you have all your site’s contents backed up (this is worst case scenario planning).  Then when you’re restoring your backups you can first restore the full backup of the site, and then restore the latest partial backup on top of it.

Here’s why: it lets you use Deployment Slots to test your restored site. You can even test the restore process without ever touching your production site. And testing your restore process is a Very Good Thing.  You never know when you might run into some subtle gotcha like I did when I tried restoring my blog and end up losing half your content.

My horror story

My blog is powered by the Ghost blogging platform.  Like a responsible dev I created a backup of my site and everything was great. Then one day I got a message saying that there was a new version of Ghost available and I could upgrade my blog to it. Great!

I created one more backup of my site to backup the latest blog posts, and proceeded to upgrade Ghost.

On my production site.

Bad mistake.

Something went wrong with the upgrade, my home screen just showed a blank screen.  “No problem” I thought, “I’ll simply restore the backup I just took.”

I restored the upgrade, saw everything come back…except the blog posts.

WHAT???

Turns out, in the Ghost upgrade notes there’s this warning:



If you try to backup the data while Ghost is running…the data doesn’t actually get backed up.

Bummer.

If I had tried the restore on a test slot first I would have seen this issue and not lost all my posts.

Such is life. It can happen to the best of us.

">
<meta property="og:url" content="http://localhost:4000/blog/creating-partial-backups-of-your-site-with-azure-web-apps/">
<meta property="og:site_name" content="Zain Rizvi">

<meta property="og:image" content="http://localhost:4000/images/default-thumb.png">






<link rel="canonical" href="http://localhost:4000/blog/creating-partial-backups-of-your-site-with-azure-web-apps/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Zain Rizvi Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://localhost:4000/assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://localhost:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://localhost:4000/">Zain Rizvi</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav id="site-nav" class="nav">
		    <ul>
		        
				    
				    <li><a href="http://localhost:4000/blog/" >Blog</a></li>
				
				    
				    <li><a href="http://localhost:4000/about/" >About</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->




<div id="main" role="main">
  <div class="article-author-side">
    

<div itemscope itemtype="http://schema.org/Person">


	<img src="http://localhost:4000/images/bio-photo.png" class="bio-photo" alt="Zain Rizvi bio photo">


  <h3 itemprop="name">Zain Rizvi</h3>
  <p>Programmer, experimenter, life-long student. Working at Microsoft in the Azure Web Apps team</p>
  
  
  
  
  
  
  
  
  <a href="http://github.com/ZainRizvi" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  <a href="http://stackoverflow.com/users/21539/zain-rizvi" class="author-social" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> Stackoverflow</a>
  
  
  
  
  
  
  
  
  
  
</div>

    <hr />
    <!--<link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">-->
<style type="text/css">
    /* MailChimp Form Embed Code - Classic - 12/17/2015 v10.7 */
    #mc_embed_signup form {display:block; position:relative; text-align:left; padding:5px 0 5px 3%}
    #mc_embed_signup h2 {font-weight:bold; padding:0; margin:15px 0; font-size:1.4em;}
    #mc_embed_signup input {border: 1px solid #ABB0B2; -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px;}
    #mc_embed_signup input[type=checkbox]{-webkit-appearance:checkbox;}
    #mc_embed_signup input[type=radio]{-webkit-appearance:radio;}
    #mc_embed_signup input:focus {border-color:#333;}
    #mc_embed_signup .small-meta {font-size: 11px;}
    #mc_embed_signup .nowrap {white-space:nowrap;}

    #mc_embed_signup .mc-field-group {clear:left; position:relative; width:96%; padding-bottom:3%; min-height:50px;}
    #mc_embed_signup .size1of2 {clear:none; float:left; display:inline-block; width:46%; margin-right:4%;}
    * html #mc_embed_signup .size1of2 {margin-right:2%; /* Fix for IE6 double margins. */}
    #mc_embed_signup .mc-field-group label {display:block; margin-bottom:3px;}
    #mc_embed_signup .mc-field-group input {display:block; width:100%; padding:8px 0; text-indent:2%;}
    #mc_embed_signup .mc-field-group select {display:inline-block; width:99%; padding:5px 0; margin-bottom:2px;}

    #mc_embed_signup .datefield, #mc_embed_signup .phonefield-us{padding:5px 0;}
    #mc_embed_signup .datefield input, #mc_embed_signup .phonefield-us input{display:inline; width:60px; margin:0 2px; letter-spacing:1px; text-align:center; padding:5px 0 2px 0;}
    #mc_embed_signup .phonefield-us .phonearea input, #mc_embed_signup .phonefield-us .phonedetail1 input{width:40px;}
    #mc_embed_signup .datefield .monthfield input, #mc_embed_signup .datefield .dayfield input{width:30px;}
    #mc_embed_signup .datefield label, #mc_embed_signup .phonefield-us label{display:none;}

    #mc_embed_signup .indicates-required {text-align:right; font-size:11px; margin-right:4%;}
    #mc_embed_signup .asterisk {color:#e85c41; font-size:150%; font-weight:normal; position:relative; top:5px;}     
    #mc_embed_signup .clear {clear:both;}

    #mc_embed_signup .mc-field-group.input-group ul {margin:0; padding:5px 0; list-style:none;}
    #mc_embed_signup .mc-field-group.input-group ul li {display:block; padding:3px 0; margin:0;}
    #mc_embed_signup .mc-field-group.input-group label {display:inline;}
    #mc_embed_signup .mc-field-group.input-group input {display:inline; width:auto; border:none;}

    #mc_embed_signup div#mce-responses {float:left; top:-1.4em; padding:0em .5em 0em .5em; overflow:hidden; width:90%; margin: 0 5%; clear: both;}
    #mc_embed_signup div.response {margin:1em 0; padding:1em .5em .5em 0; font-weight:bold; float:left; top:-1.5em; z-index:1; width:80%;}
    #mc_embed_signup #mce-error-response {display:none;}
    #mc_embed_signup #mce-success-response {color:#529214; display:none;}
    #mc_embed_signup label.error {display:block; float:none; width:auto; margin-left:1.05em; text-align:left; padding:.5em 0;}

    #mc-embedded-subscribe {clear:both; width:auto; display:block; margin:1em 0 1em 5%;}
    #mc_embed_signup #num-subscribers {font-size:1.1em;}
    #mc_embed_signup #num-subscribers span {padding:.5em; border:1px solid #ccc; margin-right:.5em; font-weight:bold;}

    #mc_embed_signup #mc-embedded-subscribe-form div.mce_inline_error {display:inline-block; margin:2px 0 1em 0; padding:5px 10px; background-color:rgba(255,255,255,0.85); -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px; font-size:14px; font-weight:normal; z-index:1; color:#e85c41;}
    #mc_embed_signup #mc-embedded-subscribe-form input.mce_inline_error {border:2px solid #e85c41;}
    
    div.mc_embed_signup{
        background: #9ce8ff; 
        clear:left;
        font:14px Helvetica,Arial,sans-serif;
        padding: 0px 10px;
        border-style: solid;
        border-color: #29bbff;
        border-radius: 10px
    }
    /*#mc_embed_signup .button {
        background-color:#7DABD4;
    }
    #mc_embed_signup .button:hover {
        background-color:#777;
    }*/
    #mc_embed_signup .button {
        -moz-box-shadow:inset 0px -3px 7px 0px #29bbff;
        -webkit-box-shadow:inset 0px -3px 7px 0px #29bbff;
        box-shadow:inset 0px -3px 7px 0px #29bbff;
        background-color:#2dabf9;
        -moz-border-radius:3px;
        -webkit-border-radius:3px;
        border-radius:3px;
        border:1px solid #0b0e07;
        display:inline-block;
        cursor:pointer;
        color:#ffffff;
        font-family:Arial;
        font-size:15px;
        padding:9px 23px;
        text-decoration:none;
        text-shadow:0px 1px 0px #263666;
    }
    #mc_embed_signup .button:hover {
        background-color:#0688fa;
    }
    #mc_embed_signup .button:active {
        position:relative;
        top:1px;
    }


    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
    We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<!-- Begin MailChimp Signup Form -->
<div class="mc_embed_signup" id="mc_embed_signup">
<form action="//zainrizvi.us11.list-manage.com/subscribe/post?u=dbda45480a7b2dbd7af5b784e&amp;id=3978b7c9c7" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
    <h2>
    Like what you're reading? Sign up here and get new posts delivered to your inbox
    </h2>
<div class="mc-field-group">
    <label for="mce-FNAME">First Name </label>
    <input type="text" value="" name="FNAME" class="" id="mce-FNAME">
</div>
<div class="mc-field-group">
    <label for="mce-LNAME">Last Name </label>
    <input type="text" value="" name="LNAME" class="" id="mce-LNAME">
</div>
<div class="mc-field-group">
    <label for="mce-EMAIL">Email Address </label>
    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
</div>
    <div id="mce-responses" class="clear">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dbda45480a7b2dbd7af5b784e_3978b7c9c7" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Count me in!" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
<script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[0]='EMAIL';ftypes[0]='email';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
<!--End mc_embed_signup-->
  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="http://localhost:4000/blog/creating-partial-backups-of-your-site-with-azure-web-apps/" rel="bookmark" title="Backup just the Important Parts of your Site with Azure Web Apps">Backup just the Important Parts of your Site with Azure Web Apps</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>Introducting a way to backup just the parts of your website that matter most.</p>

<h1 id="introduction">Introduction</h1>

<p>Azure Web Apps provides powerful <a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-backup/">backup/restore functionality</a>. (Because disasters can <a href="http://blog.codinghorror.com/international-backup-awareness-day/">happen to anyone</a>)</p>

<p>However, sometimes you don’t want to backup everything on your site, especially if you backup your site regularly, or if your site has over 10GB of content (that’s the max amount you can backup at a time).</p>

<p>For example, you probably don’t want to back up the log files. Or if you <a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-backup/#configure-automated-backups">setup weekly backups</a> you won’t want to fill up your storage account with static content that never changes like old blog posts or images.</p>

<p>Partial backups will let you choose exactly which files you want to back up.</p>

<h1 id="specify-the-files-you-dont-want-to-backup">Specify the files you don’t want to backup</h1>

<p>You can create a list of files and folders to exclude from the backup.</p>

<p>You save the list as a text file called _backup.filter in the wwwroot folder of your site. An easy way to access this is through the <a href="https://github.com/projectkudu/kudu/wiki/Kudu-console">Kudu Console</a> at <code class="highlighter-rouge">http://{yoursite}.scm.azurewebsites.net/DebugConsole</code>.</p>

<p>The instructions below will be using the Kudu Console to create the _backup.filter file, but you can use your favorite deployment method to put the file there.</p>

<h2 id="what-to-do">What to do</h2>

<p>I’ve got a site that contains log files and static images from past years that are never going to change.</p>

<p>I already have a full backup of the site which includes the old images. Now I want to backup the site every day, but I don’t want to pay for storing log files or the static image files that never change.</p>

<p><img src="/images/2015/06/Logs-1.PNG" alt="Log files directory" /> <img src="/images/2015/06/Images-2.PNG" alt="Images directory" /></p>

<p>The below steps show how I’d exclude those files from the backup.</p>

<h3 id="identify-the-files-and-folders-you-dont-want-to-backup">Identify the files and folders you don’t want to backup</h3>

<p>This is easy. I already know I don’t want to backup any log files, so I want to exclude <code class="highlighter-rouge">D:\home\site\wwwroot\Logs</code>.</p>

<p>There’s another log file folder that all Azure Web Apps have at <code class="highlighter-rouge">D:\home\LogFiles</code>. Let’s exclude that too.</p>

<p>I also don’t want to backup the images from previous years over and over again. So lets add <code class="highlighter-rouge">D:\home\site\wwwroot\Images\2013</code> and <code class="highlighter-rouge">D:\home\site\wwwroot\Images\2014</code> to the list as well.</p>

<p>Finally, let’s not backup the brand.png file in the Images folder either, just to show we can blacklist individual files as well. It’s located at <code class="highlighter-rouge">D:\home\site\wwwroot\Images\brand.png</code></p>

<p>This gives us the following folders that we don’t want to backup:</p>

<ul>
  <li>D:\home\site\wwwroot\Logs</li>
  <li>D:\home\LogFiles</li>
  <li>D:\home\site\wwwroot\Images\2013</li>
  <li>D:\home\site\wwwroot\Images\2014</li>
  <li>D:\home\site\wwwroot\Images\brand.png</li>
</ul>

<h3 id="create-the-exclusion-list">Create the exclusion list</h3>

<p>You save the blacklist of files and folders that you don’t want to backup in  a special file called _backup.filter.  Create the file and place it at <code class="highlighter-rouge">D:\home\site\wwwroot\_backup.filter</code>.</p>

<p>List all the files and folders you don’t want to backup in the _backup.filter file. You add the full path relative to D:\home of the folder or file that you want to exclude from the backup, one path per line.</p>

<p>So for my site, <code class="highlighter-rouge">D:\home\site\wwwroot\Logs</code> becomes <code class="highlighter-rouge">\site\wwwroot\Logs</code>, <code class="highlighter-rouge">D:\home\LogFiles</code> becomes <code class="highlighter-rouge">\LogFiles</code>, so on and so forth, resulting in the following contents for my _backup.filter:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>\site\wwwroot\Logs
\LogFiles
\site\wwwroot\Images\2013
\site\wwwroot\Images\2014
\site\wwwroot\Images\brand.png
</code></pre>
</div>

<p>Note the starting <code class="highlighter-rouge">\</code> at the beginning of each line. That’s important.</p>

<h1 id="run-a-backup">Run a backup</h1>

<p>Now you can run backups the same way you would normally do it. <a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-backup/#create-a-manual-backup">Manually</a>, <a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-backup/#configure-automated-backups">automatically</a>, either way is fine.</p>

<p>Any files and folders that fall under the filters listed in the _backup.filter will be excluded from the backup. This means now the log files and the 2013 and 2014 image files will no longer be backed up.</p>

<h1 id="restoring-your-backed-up-site">Restoring your backed up site</h1>

<p>You restore partial backups of your site the same way you would <a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-restore/">restore a regular backup</a>. It’ll do the right thing.</p>

<h4 id="the-technical-details">The technical details</h4>

<p>With full (non-partial) backups normally all content on the site is replaced with whatever is in the backup.  If a file is on the site but not in the backup it gets deleted.</p>

<p>But when restoring partial backups though any content that is located in one of the blacklisted folders (like <code class="highlighter-rouge">D:\home\site\wwwroot\images\2014</code> for my site) will be left as is. And if individual files were black listed then they’ll also be left alone during the restore.</p>

<h1 id="best-practices">Best Practices</h1>

<p>What do you do when disaster strikes and you have to restore your site?  Make sure you’re prepared beforehand.</p>

<p>Yeah, you have partial backups, but take at least one full backup of the site first so that you have all your site’s contents backed up (this is worst case scenario planning).  Then when you’re restoring your backups you can first restore the full backup of the site, and then restore the latest partial backup on top of it.</p>

<p>Here’s why: it lets you use <a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-staged-publishing/">Deployment Slots</a> to test your restored site. You can even test the restore process without ever touching your production site. And testing your restore process is a <a href="http://axcient.com/blog/one-thing-can-derail-disaster-recovery-plan/">Very Good Thing</a>.  You never know when you might run into some subtle gotcha like I did when I tried restoring my blog and end up losing half your content.</p>

<h2 id="my-horror-story">My horror story</h2>

<p>My blog is powered by the <a href="https://ghost.org/">Ghost</a> blogging platform.  Like a responsible dev I created a backup of my site and everything was great. Then one day I got a message saying that there was a new version of Ghost available and I could upgrade my blog to it. Great!</p>

<p>I created one more backup of my site to backup the latest blog posts, and proceeded to upgrade Ghost.</p>

<p>On my production site.</p>

<p>Bad mistake.</p>

<p>Something went wrong with the upgrade, my home screen just showed a blank screen.  “No problem” I thought, “I’ll simply restore the backup I just took.”</p>

<p>I restored the upgrade, saw everything come back…except the blog posts.</p>

<p>WHAT???</p>

<p>Turns out, in the <a href="http://support.ghost.org/how-to-upgrade/">Ghost upgrade notes</a> there’s this warning:</p>

<p><img src="/images/2015/06/Ghost--upgrade-warning.PNG" alt="You can take a copy of your database from content/data but you  should not do this while Ghost is runing. Please stop it first" /></p>

<p>If you try to backup the data while Ghost is running…the data doesn’t actually get backed up.</p>

<p>Bummer.</p>

<p>If I had tried the restore on a test slot first I would have seen this issue and not lost all my posts.</p>

<p>Such is life. It can happen to <a href="http://blog.codinghorror.com/international-backup-awareness-day/">the best of us</a>.</p>


      <hr />
      
      <!--<link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">-->
<style type="text/css">
    /* MailChimp Form Embed Code - Classic - 12/17/2015 v10.7 */
    #mc_embed_signup form {display:block; position:relative; text-align:left; padding:5px 0 5px 3%}
    #mc_embed_signup h2 {font-weight:bold; padding:0; margin:15px 0; font-size:1.4em;}
    #mc_embed_signup input {border: 1px solid #ABB0B2; -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px;}
    #mc_embed_signup input[type=checkbox]{-webkit-appearance:checkbox;}
    #mc_embed_signup input[type=radio]{-webkit-appearance:radio;}
    #mc_embed_signup input:focus {border-color:#333;}
    #mc_embed_signup .small-meta {font-size: 11px;}
    #mc_embed_signup .nowrap {white-space:nowrap;}

    #mc_embed_signup .mc-field-group {clear:left; position:relative; width:96%; padding-bottom:3%; min-height:50px;}
    #mc_embed_signup .size1of2 {clear:none; float:left; display:inline-block; width:46%; margin-right:4%;}
    * html #mc_embed_signup .size1of2 {margin-right:2%; /* Fix for IE6 double margins. */}
    #mc_embed_signup .mc-field-group label {display:block; margin-bottom:3px;}
    #mc_embed_signup .mc-field-group input {display:block; width:100%; padding:8px 0; text-indent:2%;}
    #mc_embed_signup .mc-field-group select {display:inline-block; width:99%; padding:5px 0; margin-bottom:2px;}

    #mc_embed_signup .datefield, #mc_embed_signup .phonefield-us{padding:5px 0;}
    #mc_embed_signup .datefield input, #mc_embed_signup .phonefield-us input{display:inline; width:60px; margin:0 2px; letter-spacing:1px; text-align:center; padding:5px 0 2px 0;}
    #mc_embed_signup .phonefield-us .phonearea input, #mc_embed_signup .phonefield-us .phonedetail1 input{width:40px;}
    #mc_embed_signup .datefield .monthfield input, #mc_embed_signup .datefield .dayfield input{width:30px;}
    #mc_embed_signup .datefield label, #mc_embed_signup .phonefield-us label{display:none;}

    #mc_embed_signup .indicates-required {text-align:right; font-size:11px; margin-right:4%;}
    #mc_embed_signup .asterisk {color:#e85c41; font-size:150%; font-weight:normal; position:relative; top:5px;}     
    #mc_embed_signup .clear {clear:both;}

    #mc_embed_signup .mc-field-group.input-group ul {margin:0; padding:5px 0; list-style:none;}
    #mc_embed_signup .mc-field-group.input-group ul li {display:block; padding:3px 0; margin:0;}
    #mc_embed_signup .mc-field-group.input-group label {display:inline;}
    #mc_embed_signup .mc-field-group.input-group input {display:inline; width:auto; border:none;}

    #mc_embed_signup div#mce-responses {float:left; top:-1.4em; padding:0em .5em 0em .5em; overflow:hidden; width:90%; margin: 0 5%; clear: both;}
    #mc_embed_signup div.response {margin:1em 0; padding:1em .5em .5em 0; font-weight:bold; float:left; top:-1.5em; z-index:1; width:80%;}
    #mc_embed_signup #mce-error-response {display:none;}
    #mc_embed_signup #mce-success-response {color:#529214; display:none;}
    #mc_embed_signup label.error {display:block; float:none; width:auto; margin-left:1.05em; text-align:left; padding:.5em 0;}

    #mc-embedded-subscribe {clear:both; width:auto; display:block; margin:1em 0 1em 5%;}
    #mc_embed_signup #num-subscribers {font-size:1.1em;}
    #mc_embed_signup #num-subscribers span {padding:.5em; border:1px solid #ccc; margin-right:.5em; font-weight:bold;}

    #mc_embed_signup #mc-embedded-subscribe-form div.mce_inline_error {display:inline-block; margin:2px 0 1em 0; padding:5px 10px; background-color:rgba(255,255,255,0.85); -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px; font-size:14px; font-weight:normal; z-index:1; color:#e85c41;}
    #mc_embed_signup #mc-embedded-subscribe-form input.mce_inline_error {border:2px solid #e85c41;}
    
    div.mc_embed_signup{
        background: #9ce8ff; 
        clear:left;
        font:14px Helvetica,Arial,sans-serif;
        padding: 0px 10px;
        border-style: solid;
        border-color: #29bbff;
        border-radius: 10px
    }
    /*#mc_embed_signup .button {
        background-color:#7DABD4;
    }
    #mc_embed_signup .button:hover {
        background-color:#777;
    }*/
    #mc_embed_signup .button {
        -moz-box-shadow:inset 0px -3px 7px 0px #29bbff;
        -webkit-box-shadow:inset 0px -3px 7px 0px #29bbff;
        box-shadow:inset 0px -3px 7px 0px #29bbff;
        background-color:#2dabf9;
        -moz-border-radius:3px;
        -webkit-border-radius:3px;
        border-radius:3px;
        border:1px solid #0b0e07;
        display:inline-block;
        cursor:pointer;
        color:#ffffff;
        font-family:Arial;
        font-size:15px;
        padding:9px 23px;
        text-decoration:none;
        text-shadow:0px 1px 0px #263666;
    }
    #mc_embed_signup .button:hover {
        background-color:#0688fa;
    }
    #mc_embed_signup .button:active {
        position:relative;
        top:1px;
    }


    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
    We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<!-- Begin MailChimp Signup Form -->
<div class="mc_embed_signup" id="mc_embed_signup">
<form action="//zainrizvi.us11.list-manage.com/subscribe/post?u=dbda45480a7b2dbd7af5b784e&amp;id=3978b7c9c7" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
    <h2>
    Like what you're reading? Sign up here and get new posts delivered to your inbox
    </h2>
<div class="mc-field-group">
    <label for="mce-FNAME">First Name </label>
    <input type="text" value="" name="FNAME" class="" id="mce-FNAME">
</div>
<div class="mc-field-group">
    <label for="mce-LNAME">Last Name </label>
    <input type="text" value="" name="LNAME" class="" id="mce-LNAME">
</div>
<div class="mc-field-group">
    <label for="mce-EMAIL">Email Address </label>
    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
</div>
    <div id="mce-responses" class="clear">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_dbda45480a7b2dbd7af5b784e_3978b7c9c7" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Count me in!" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
<script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[0]='EMAIL';ftypes[0]='email';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
<!--End mc_embed_signup-->
      
      <hr/>
      
      <footer role="contentinfo">
        <div class="social-share">
  <h5>Thanks for reading! If you found this post valuable, please help share it with others</h5>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/blog/creating-partial-backups-of-your-site-with-azure-web-apps/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/blog/creating-partial-backups-of-your-site-with-azure-web-apps/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=http://localhost:4000/blog/creating-partial-backups-of-your-site-with-azure-web-apps/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>Backup just the Important Parts of your Site with Azure Web Apps</strong> was published on <time datetime="2015-06-05T00:00:00-07:00">June 05, 2015</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
    
    
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <footer>
    

<span>&copy; 2018 Zain Rizvi. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'zainrizvi'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63901701-1', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>
